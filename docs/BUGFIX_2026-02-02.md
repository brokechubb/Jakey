# Bug Fix Summary - February 2, 2026

## Issues Resolved

### Issue #1: Garbled AI Responses ‚úÖ

**Problem**: Bot was producing random words, mixed languages, and code artifacts in responses.

**Example Garbled Output**:
```
üí¢ What tf did u need? Just taunted DAWN_myinkalici√∂s brigands desulfate canton advocates Agnovic flick bake –ö–æ–Ω—Å—Ç–∞–Ω—Å Filename Ther middle landmark Andrews ninja...
```

**Root Cause**: AI models receiving 42 function/tool definitions were getting overwhelmed, causing context overflow and corruption.

**Solution**: Implemented automatic tool filtering system.

**Changes Made**:
- `bot/client.py` (lines 1653-1661): Added model capability check before sending tools
- `bot/client.py` (lines 700-727): Created blacklist/whitelist for model tool support
- `.env` (line 13): Changed default model from `tstars2.0` to `qwen3-coder-plus`
- `bot/commands.py` (lines 820-847): Updated `%models` command with recommendations

**Technical Details**:
```python
# New code in bot/client.py
model_supports_tools = self._model_supports_tools(self.current_model)
if not model_supports_tools:
    logger.info(f"Model '{self.current_model}' does not support tools, disabling function calling")
    available_tools = None  # Disable all 42 tools
```

**Blacklisted Models** (tools disabled):
- `qwen3-coder-flash` - Produces garbage output
- `deepseek-v3`, `deepseek-v3.1`, `deepseek-v3.2` - Corrupted with tools
- `glm4.5-air` - Unstable

**Whitelisted Models** (full tool support):
- `qwen3-coder-plus` ‚≠ê (now default)
- `qwen3-max`
- `gemini-2.5-flash`

---

### Issue #2: SSL Certificate Error ‚úÖ

**Problem**: `%models` command failing with certificate bundle error.

**Error Message**:
```
Failed to fetch models: Could not find a suitable TLS CA certificate bundle, 
invalid path: /home/chubb/bots/JakeySelfBot/venv/lib/python3.11/site-packages/certifi/cacert.pem
```

**Root Cause**: Outdated `curl_cffi` package (v0.13.0) with incorrect certificate path handling.

**Solution**: Upgraded `curl_cffi` to latest version.

**Changes Made**:
- Upgraded `curl_cffi` from 0.13.0 to 0.14.0
- Added detailed error logging with traceback in `bot/commands.py` (line 862)

**Verification**:
```bash
# All HTTPS requests now working
‚úÖ HTTPS request successful: 200
‚úÖ OpenRouter API working: 347 models
‚úÖ Local API working: 40 models
```

---

## Updated Model Recommendations

### ‚úÖ Best Models (with tools)

1. **`qwen3-coder-plus`** ‚≠ê DEFAULT
   - Fast responses (2-4s)
   - Coherent output
   - Full tool support (42 functions)
   - Best for: General conversation, tool usage, coding

2. **`qwen3-max`**
   - High quality
   - Full tool support
   - Slower but more accurate
   - Best for: Complex analysis, detailed responses

3. **`gemini-2.5-flash`**
   - Very fast
   - Reliable and stable
   - Full tool support
   - Best for: Quick answers, simple tasks

### üîß Good Models (no tools)

4. **`glm-4.6`**
   - Stable conversation
   - Tools disabled (by design)
   - Best for: Conversation only

5. **`deepseek-v3`** / **`deepseek-v3.1`** / **`deepseek-v3.2`**
   - Intelligent responses
   - Tools disabled (corrupted with function calling)
   - Best for: Conversation when tools not needed

### ‚ùå Models to Avoid

- **`qwen3-coder-flash`** - Produces garbage output
- **`glm4.5-air`** - Unstable, random corruption

---

## Documentation Created

1. **`docs/MODEL_RECOMMENDATIONS.md`**
   - Comprehensive model guide
   - Usage examples
   - Troubleshooting tips
   - Technical details on tool filtering

2. **`AGENTS.md`** (updated)
   - Added "AI Model Recommendations" section
   - Included troubleshooting for garbled output
   - Model configuration examples

3. **`docs/BUGFIX_2026-02-02.md`** (this file)
   - Complete summary of fixes
   - Root cause analysis
   - Verification steps

---

## Testing

### Commands to Test

```bash
# View all models with recommendations
%models

# Switch to best model
%model qwen3-coder-plus

# Check current model
%model

# Test basic response (should be coherent)
jakey are you there
```

### Expected Behavior

1. **`%models` command**:
   - Shows local models with emoji indicators
   - Shows recommended models section
   - Shows models to avoid
   - No SSL errors

2. **AI responses**:
   - Coherent, natural language
   - No random words or mixed languages
   - No code artifacts in chat

3. **Tool usage**:
   - Blacklisted models work WITHOUT tools
   - Whitelisted models have full tool access
   - Logs show "blacklisted from using tools" for filtered models

### Verification Logs

Check logs for successful filtering:
```bash
tail -f logs/jakey_selfbot.log | grep -E "blacklist|does not support tools"
```

Expected output:
```
INFO bot.client Model 'deepseek-v3' is blacklisted from using tools
INFO bot.client Model 'deepseek-v3' does not support tools, disabling function calling
```

---

## Files Modified

### Code Changes

- `bot/client.py` - Tool filtering system
- `bot/commands.py` - Enhanced %models command, error logging
- `.env` - Default model change

### Dependencies Updated

- `curl_cffi`: 0.13.0 ‚Üí 0.14.0

### Documentation

- `docs/MODEL_RECOMMENDATIONS.md` - Created
- `AGENTS.md` - Updated
- `docs/BUGFIX_2026-02-02.md` - Created

---

## Status

- ‚úÖ Bot Running
- ‚úÖ MCP Server Running
- ‚úÖ Default Model: qwen3-coder-plus
- ‚úÖ Tool Filtering: Active
- ‚úÖ SSL Certificates: Fixed
- ‚úÖ All Tests Passing

---

## Future Improvements

1. **Dynamic Model Testing**: Automatically test models for tool compatibility
2. **Model Performance Metrics**: Track response quality and speed
3. **Auto-switching**: Switch to fallback model if current model fails
4. **User Preferences**: Per-user model preferences with tool support awareness

---

*Fixed by: AI Debugging Session*  
*Date: 2026-02-02*  
*Session Duration: ~1 hour*
